<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<head>
    <title>Search Properties - RentEase</title>

    <style>
        body {
            background: linear-gradient(to right, #f8f9fa, #e3f2fd);
            font-family: 'Segoe UI', sans-serif;
        }

        .search-section {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            transition: transform 0.3s;
        }

        .search-title {
            font-weight: bold;
            margin-bottom: 1.25rem;
            color: #0d6efd;
        }

        .search-section:hover {
            transform: translateY(-5px);
        }

        .house-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .house-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        }

        .house-location {
            color: #6c757d;
            font-size: 0.95rem;
        }

        .feature-item {
            margin-right: 10px;
            font-size: 0.85rem;
            color: #495057;
        }

        .house-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: #0d6efd;
        }

        .form-control, .form-select {
            border-radius: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(to right, #0d6efd, #0b5ed7);
            border: none;
        }

        .btn-outline-secondary:hover {
            background-color: #dee2e6;
        }

        .pagination .page-item.active .page-link {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
    </style>

</head>
<body>
<div layout:fragment="content">
    <div class="container py-4">
        <div class="row">
            <!-- Search Filters Sidebar -->
            <div class="col-lg-3 mb-4">
                <div class="search-section sticky-top" style="top: 100px;">
                    <h4 class="search-title"><i class="fas fa-filter me-2"></i>Search Filters</h4>

                    <form th:action="@{/search}" method="get" id="searchForm">
                        <!-- Keyword Search -->
                        <div class="mb-3">
                            <label for="keyword" class="form-label">Keyword</label>
                            <input type="text" class="form-control" id="keyword" name="keyword"
                                   th:value="${keyword}" placeholder="Enter keywords...">
                        </div>

                        <!-- Location -->
                        <div class="row">
                            <div class="col-6 mb-3">
                                <label for="city" class="form-label">City</label>
                                <input type="text" class="form-control" id="city" name="city"
                                       th:value="${city}" placeholder="City">
                            </div>
                            <div class="col-6 mb-3">
                                <label for="state" class="form-label">State</label>
                                <input type="text" class="form-control" id="state" name="state"
                                       th:value="${state}" placeholder="State">
                            </div>
                        </div>

                        <!-- Price Range -->
                        <div class="mb-3">
                            <label class="form-label">Price Range (Monthly)</label>
                            <div class="row">
                                <div class="col-6">
                                    <input type="number" class="form-control" name="minPrice"
                                           th:value="${minPrice}" placeholder="Min $" min="0">
                                </div>
                                <div class="col-6">
                                    <input type="number" class="form-control" name="maxPrice"
                                           th:value="${maxPrice}" placeholder="Max $" min="0">
                                </div>
                            </div>
                        </div>

                        <!-- Bedrooms & Bathrooms -->
                        <div class="row">
                            <div class="col-6 mb-3">
                                <label for="bedrooms" class="form-label">Min Bedrooms</label>
                                <select class="form-select" id="bedrooms" name="bedrooms">
                                    <option value="">Any</option>
                                    <option th:each="i : ${#numbers.sequence(1, 5)}"
                                            th:value="${i}" th:text="${i}"
                                            th:selected="${bedrooms != null and bedrooms == i}"></option>
                                    <option value="6" th:selected="${bedrooms != null and bedrooms >= 6}">6+</option>
                                </select>
                            </div>
                            <div class="col-6 mb-3">
                                <label for="bathrooms" class="form-label">Min Bathrooms</label>
                                <select class="form-select" id="bathrooms" name="bathrooms">
                                    <option value="">Any</option>
                                    <option th:each="i : ${#numbers.sequence(1, 4)}"
                                            th:value="${i}" th:text="${i}"
                                            th:selected="${bathrooms != null and bathrooms == i}"></option>
                                    <option value="5" th:selected="${bathrooms != null and bathrooms >= 5}">5+</option>
                                </select>
                            </div>
                        </div>

                        <!-- Property Type -->
                        <div class="mb-4">
                            <label for="propertyType" class="form-label">Property Type</label>
                            <select class="form-select" id="propertyType" name="propertyType">
                                <option value="">All Types</option>
                                <option th:each="type : ${propertyTypes}"
                                        th:value="${type}"
                                        th:text="${#strings.capitalize(#strings.toLowerCase(type))}"
                                        th:selected="${propertyType != null and propertyType == type}"></option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-search me-2"></i>Search Properties
                        </button>

                        <a th:href="@{/search}" class="btn btn-outline-secondary w-100 mt-2">
                            <i class="fas fa-times me-2"></i>Clear Filters
                        </a>
                    </form>
                </div>
            </div>

            <!-- Search Results -->
            <div class="col-lg-9">
                <!-- Results Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="mb-1">Search Results</h2>
                        <p class="text-muted mb-0" th:if="${houses != null}">
                            Found <strong th:text="${houses.totalElements}">0</strong> properties
                            <span th:if="${keyword != null and !keyword.isEmpty()}"> for "<span th:text="${keyword}"></span>"</span>
                        </p>
                    </div>
                    <div class="d-flex align-items-center">
                        <label for="sortBy" class="form-label me-2 mb-0">Sort by:</label>
                        <select class="form-select" id="sortBy" style="width: auto;">
                            <option value="newest">Newest First</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="bedrooms">Most Bedrooms</option>
                        </select>
                    </div>
                </div>

                <!-- Results Grid -->
                <div th:if="${houses != null and !houses.empty}">
                    <div class="row g-4">
                        <div class="col-md-6 col-xl-4" th:each="house : ${houses.content}">
                            <div class="card house-card h-100">
                                <div class="position-relative">
                                    <img th:src="${house.images != null and !house.images.empty ? house.images[0] : 'https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'}"
                                         class="card-img-top" th:alt="${house.title}">
                                    <div class="position-absolute top-0 end-0 m-2">
                                        <span class="badge bg-success" th:text="${house.availabilityStatus}">Available</span>
                                    </div>
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title" th:text="${house.title}">House Title</h5>
                                    <p class="house-location mb-2">
                                        <i class="fas fa-map-marker-alt me-1"></i>
                                        <span th:text="${house.fullAddress}">Full Address</span>
                                    </p>
                                    <div class="house-features mb-3">
                                            <span class="feature-item" th:if="${house.bedrooms != null}">
                                                <i class="fas fa-bed"></i>
                                                <span th:text="${house.bedrooms}">2</span> Beds
                                            </span>
                                        <span class="feature-item" th:if="${house.bathrooms != null}">
                                                <i class="fas fa-bath"></i>
                                                <span th:text="${house.bathrooms}">1</span> Baths
                                            </span>
                                        <span class="feature-item" th:if="${house.squareFeet != null}">
                                                <i class="fas fa-ruler-combined"></i>
                                                <span th:text="${house.squareFeet}">1200</span> sq ft
                                            </span>
                                    </div>

                                    <!-- Amenities Preview -->
                                    <div class="mb-3" th:if="${house.amenities != null and !house.amenities.empty}">
                                        <div class="d-flex flex-wrap gap-1">
                                                <span th:each="amenity, iterStat : ${house.amenities}"
                                                      th:if="${iterStat.index < 3}"
                                                      class="badge bg-light text-dark" th:text="${amenity}">Amenity</span>
                                            <span th:if="${house.amenities.size() > 3}"
                                                  class="badge bg-secondary">+<span th:text="${house.amenities.size() - 3}">2</span> more</span>
                                        </div>
                                    </div>

                                    <div class="mt-auto">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="house-price" th:text="'Rs' + ${house.pricePerMonth} + '/month'">Rs2,500/month</div>
                                            <a th:href="@{/houses/{id}(id=Rs{house.id})}" class="btn btn-primary btn-sm">View Details</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <nav th:if="${houses.totalPages > 1}" class="mt-5">
                        <ul class="pagination justify-content-center">
                            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                                <a class="page-link" th:href="@{/search(page=${currentPage - 1}, keyword=${keyword}, city=${city}, state=${state}, minPrice=${minPrice}, maxPrice=${maxPrice}, bedrooms=${bedrooms}, bathrooms=${bathrooms}, propertyType=${propertyType})}">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            </li>

                            <li th:each="pageNum : ${#numbers.sequence(0, houses.totalPages - 1)}"
                                th:if="${pageNum >= currentPage - 2 and pageNum <= currentPage + 2}"
                                class="page-item" th:classappend="${pageNum == currentPage} ? 'active'">
                                <a class="page-link" th:href="@{/search(page=${pageNum}, keyword=${keyword}, city=${city}, state=${state}, minPrice=${minPrice}, maxPrice=${maxPrice}, bedrooms=${bedrooms}, bathrooms=${bathrooms}, propertyType=${propertyType})}"
                                   th:text="${pageNum + 1}">1</a>
                            </li>

                            <li class="page-item" th:classappend="${currentPage == houses.totalPages - 1} ? 'disabled'">
                                <a class="page-link" th:href="@{/search(page=${currentPage + 1}, keyword=${keyword}, city=${city}, state=${state}, minPrice=${minPrice}, maxPrice=${maxPrice}, bedrooms=${bedrooms}, bathrooms=${bathrooms}, propertyType=${propertyType})}">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>

                <!-- No Results -->
                <div th:if="${houses == null or houses.empty}" class="text-center py-5">
                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                    <h4 class="text-muted">No properties found</h4>
                    <p class="text-muted">Try adjusting your search criteria or browse all available properties.</p>
                    <a th:href="@{/houses}" class="btn btn-primary">Browse All Properties</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div layout:fragment="scripts">
    <script>
        // Auto-submit form on filter change (with debounce)
        let searchTimeout;
        const searchInputs = document.querySelectorAll('#searchForm input, #searchForm select');

        searchInputs.forEach(input => {
            input.addEventListener('change', function() {
                if (this.type !== 'submit') {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        document.getElementById('searchForm').submit();
                    }, 500);
                }
            });
        });

        // Sort functionality
        document.getElementById('sortBy').addEventListener('change', function() {
            // This would typically trigger a new search with sort parameter
            console.log('Sort by:', this.value);
        });
    </script>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Animate cards on scroll
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate__animated', 'animate__fadeInUp');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.house-card').forEach(card => {
            card.style.opacity = '0';
            observer.observe(card);
        });
    });
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

</body>
</html>

